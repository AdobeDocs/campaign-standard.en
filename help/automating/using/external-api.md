---
solution: Campaign Standard
product: campaign
title: External API
description: The External API activity brings data into the Campaign Standard workflow from an external system via an HTTP API call.
audience: automating
content-type: reference
topic-tags: targeting-activities
context-tags: externalAPI,workflow,main
feature: Workflows
role: Data Architect
level: Experienced
exl-id: 44ad654e-bde9-4189-8765-0479d81dc0f7
---
# External API {#external-api}

## Description {#description}

![](assets/wf_externalAPI.png)

The **[!UICONTROL External API]** activity brings data into the workflow from an **external system** via an **HTTP API** call.

The external system endpoints can be public API endpoints, customer management systems, or serverless application instances (e.g., [Adobe I/O Runtime](https://www.adobe.io/apis/experienceplatform/runtime.html)), to mention a few categories.

>[!NOTE]
>
>For security reasons, the use of JSSPs is not supported in Campaign Standard. If you need to execute code, you can call an Adobe I/O Runtime instance via the External API activity.

The main characteristics of this activity are:

* Ability to pass data in a JSON format to a 3rd party REST API endpoint
* Ability to receive a JSON response back, map it to output tables and pass downstream to other workflow activities.
* Failure management with an outbound specific transition

### Backwards compatibility notices {#from-beta-to-ga}

With the Campaign Standard 20.4 release, the http response data size limit and response timeout guardrails have been lowered to align with best practices - see [Limitations and guardrails](#guardrails). These guardrail modifications will not take effect on existing External API activities; therefore, it is recommended that you replace existing External API activities with new versions in all workflows.

When replacing External API activities, add the new External API activity to the workflow, manually copy over the configuration details, then delete the old activity.  

>[!NOTE]
>
>You will not be able to copy over activity-specific header values as those are masked within the activity.

### Limitations and guardrails {#guardrails}

The following guardrails apply to this activity:

* 5MB http response data size limit (note: this is a change from the 50MB limit in the previous release)
* Request timeout is 1 minute (note: this is a change from the 10 minutes timeout in the previous release)
* HTTP redirects are not allowed
* Non-HTTPS Urls are rejected
* "Accept: application/json" request header and "Content-Type: application/json" response header are allowed

Specific guardrails have been put in place: 

* **JSON Max Depth**: limit the maximum depth of a custom nested JSON that can be processed to 10 levels.
* **JSON Max Key Length**: limit the maximum length of the internal key generated to 255. This key is associated with the column ID. 
* **JSON Max Duplicate Keys Allowed**:  limit the maximum total number of duplicate JSON property names, which are used as column ID, to 150.

>[!CAUTION]
>
>The External API activity is meant for fetching campaign-wide data (latest set of offers, latest scores, etc.), not for retrieving specific information for each profile as that can result in large amounts of data being transferred. If the use case requires this, the recommendation is to use the [Transfer File](../../automating/using/transfer-file.md) activity.

## Configuration {#configuration}

Drag and drop an **[!UICONTROL External API]** activity into your workflow and open the activity to start the configuration.

### Inbound Mapping

Inbound mapping is a temporary table generated by a previous inbound activity that will be displayed and sent as JSON in the UI.
Based on this temporary table, user can make modification to inbound data.

![](assets/externalAPI-inbound.png)

The **Inbound resource** dropdown lets you select the query activity that will create the temporary table.

The **Add count parameter** checkbox will add a count value for each row coming from the temporary table. Note that this checkbox is only available if the inbound activity is generating a temporary table.

The **Inbound Columns** section allow the user to add any fields from the inbound transition table. The selected column(s) will be the keys in the data object. The data object in the JSON will be an array list containing data for selected columns from each row of the inbound transition table.

The **customize parameter** text box lets you add a valid JSON with additional data needed by the external API. This additional data will be added to the params object in the generated JSON.

### Outbound Mapping

This tab lets you define the sample **JSON structure** returned by the API Call.

![](assets/externalAPI-outbound.png)

The JSON parser is designed to accommodate standard JSON structure pattern types, with some exceptions. An example of a standard pattern is:`{“data”:[{“key”:“value”}, {“key”:“value”},...]}`

The sample JSON definition must have the **following characteristics**:

* **Array elements** must contain first-level properties (deeper levels are not supported).
  **Property names** will end up becoming column names for the output schema of the output temporary table.
* **JSON elements** to be captured must be at 10 or less levels of nesting within the JSON response.  
* **Column name** definition is based on the first element of the "data" array.
  Columns definition (add/remove) and the type value of the property can be edited in the **Column definition** tab.

**Flatten checkbox** behavior:

The Flatten checkbox (default: unchecked) is provided to indicate whether to flatten the JSON to a key/value map or not.

* When the **checkbox is disabled** (unchecked), the sample JSON will be parsed to look for an array object. The user will need to provide a trimmed version of the API response sample JSON format so that Adobe Campaign can determine exactly which array the user is interested in using. At workflow authoring time, the path to the nested array object will be determined and recorded, so that it can be used at execution time to access that array object from the JSON response body received from the API call.

* When the **checkbox is enabled** (checked), the sample JSON will be flattened and all the properties that are specified in the provided sample JSON will be used to create columns of the output temporary table, and displayed on the Column Definitions tab. Note that if there are any array object in the sample JSON, then all elements of those array objects will also be flattened.


If the **parsing is validated**, a message appears and invites you to customize the data mapping in the "Column definition" tab. In other cases, an error message is displayed.

### Execution

This tab lets you define the connection endpoint. The **[!UICONTROL URL]** field allows you to define the **HTTPS Endpoint** that Campaign Standard will communicate with.

If needed by the endpoint, two types of authentification method are available:

* Basic authentification: enter your username/password information in the **[!UICONTROL Request Header(s)]** section. 

* OAuth authentification: By clicking on the **[!UICONTROL Use connection parameters defined in an external account]** in an external account, you can select an external account where the OAuth authentification is defined. For more information, refer to the [External accounts](../../administration/using/external-accounts.md) section.

![](assets/externalAPI-execution.png)

### Properties

This tab lets you control **general properties** on the external API activity like the displayed label in the UI. The internal ID is not customizable.

![](assets/externalAPI-properties.png)

### Column definition

>[!NOTE]
>
>This tab appears when the **response data format** is completed and validated in Outbound Mapping tab.

The **Column definition** tab allows you to precisely specify the data structure of each column in order to import data that does not contain any errors and make it match the types that are already present in the Adobe Campaign database for future operations.

![](assets/externalAPI-column.png)

For example, you can change the label of a column, select its type (string, integer, date, etc.) or even specify error processing.

For more information, refer to the [Load File](../../automating/using/load-file.md) section.

### Transition

This tab lets you activate the **outbound transition** and its label. This specific transition is useful in case of **timeout** or if the payload exceed the **data size limit**.

![](assets/externalAPI-transition.png)

### Execution options

This tab is available in most of the workflow activities. For more information, consult the [Activity properties](../../automating/using/activity-properties.md) section.

![](assets/externalAPI-options.png)

## Testing

To test out the External API functionality with a simple test endpoint, you can use Postman Echo: https://docs.postman-echo.com.

## Troubleshooting

There two types of log messages added to this new workflow activity: information and errors. They can help you troubleshooting potential issues.

### Information

These log messages are used to log information about useful checkpoints during the execution of the workflow activity.
<table> 
 <thead> 
  <tr> 
   <th> Message format<br /> </th> 
   <th> Example<br /> </th> 
  </tr> 
 </thead> 
 <tbody> 
  <tr> 
   <td> Invoking API URL '%s'.</td> 
   <td> <p>Invoking API URL 'https://example.com/api/v1/web-coupon?count=2'.</p></td> 
  </tr> 
  <tr> 
   <td> Retrying API URL '%s' due to %s in %d ms, attempt %d.</td> 
   <td> <p>Retrying API URL 'https://example.com/api/v1/web-coupon?count=0' due to HTTP - 401 in 2364 ms, attempt 2.</p></td>
  </tr> 
  <tr> 
   <td> Transferring content from '%s' (%s / %s).</td> 
   <td> <p>Transferring content from 'https://example.com/api/v1/web-coupon?count=2' (1234 / 1234).</p></td> 
  </tr>
  <tr> 
   <td> Using cached access token for provider ID '%s'.</td> 
   <td> <p>Using cached access token for provider ID 'EXT25'. Note:  EXT25 is the ID (or name) of the external account. </p></td> 
  </tr>
  <tr> 
   <td> Fetched access token from server for provider ID '%s'.</td> 
   <td> <p>Fetched access token from server for provider ID 'EXT25'. Note: EXT25 is the ID (or name) of the external account.</p></td> 
  </tr>
  <tr> 
   <td> Refreshing OAuth access token due to error (HTTP: '%d').</td> 
   <td> <p>Refreshing OAuth access token due to error (HTTP: '401').</p></td> 
  </tr>
  <tr> 
   <td> Error refreshing OAuth access token (error: '%d'). </td> 
   <td> <p>Error refreshing OAuth access token (error: '404').</p></td> 
  </tr>
  <tr> 
   <td> Failed to fetch the OAuth access token using the specified external account on attempt %d, retrying in %d ms.</td> 
   <td> <p>Failed to fetch the OAuth access token using the specified external account on attempt 1, retrying in 1387 ms.</p></td> 
  </tr>
 </tbody> 
</table>

### Errors

These log messages are used to log information about unexpected error conditions, that can eventually cause the workflow activity to fail.

<table> 
 <thead> 
  <tr> 
   <th> Code - Message format<br /> </th> 
   <th> Example<br /> </th> 
  </tr> 
 </thead> 
 <tbody> 
  <tr> 
   <td> WKF-560250 - API request body exceeded limit (limit: '%d').</td> 
   <td> <p>API request body exceeded limit (limit: '5242880').</p></td> 
  </tr> 
  <tr> 
   <td> WKF-560239 -  API response exceeded limit (limit: '%d').</td> 
   <td> <p>API response exceeded limit (limit: 5242880').</p></td> 
  </tr> 
  <tr> 
   <td> WKF-560245 - API URL could not be parsed (error: '%d').</td> 
   <td> <p>API URL could not be parsed (error: '-2010').</p>
   <p> Note: This error is logged when the API URL fails validation rules.</p></td>
  </tr> 
  <tr>
   <td> WKF-560244 - API URL host must not be 'localhost', or IP address literal (URL host: '%s').</td> 
   <td> <p>API URL host must not be 'localhost', or IP address literal (URL host: 'localhost').</p>
    <p>API URL host must not be 'localhost', or IP address literal (URL host: '192.168.0.5').</p>
    <p>API URL host must not be 'localhost', or IP address literal (URL host: '[2001]').</p></td>
  </tr> 
  <tr> 
   <td> WKF-560238 - API URL must be a secure URL (https) (requested URL: '%s').</td> 
   <td> <p>API URL must be a secure URL (https) (requested URL: 'https://example.com/api/v1/web-coupon?count=2').</p></td> 
  </tr> 
  <tr> 
   <td> WKF-560249 - Failed to create request body JSON. Error when adding '%s'.</td> 
   <td> <p>Failed to create request body JSON. Error when adding 'params'.</p>
    <p>Failed to create request body JSON. Error when adding 'data'.</p></td>
  </tr> 
  <tr> 
   <td> WKF-560246 - HTTP header key is bad (header key: '%s').</td> 
   <td> <p>HTTP header key is bad (header key: '%s').</p>
   <p> Note: This error is logged when the custom header key fails validation according to <a href="https://tools.ietf.org/html/rfc7230#section-3.2.html">RFC</a></p></td> 
  </tr>
 <tr> 
   <td> WKF-560248 - HTTP header key is not allowed (header key: '%s').</td> 
   <td> <p>HTTP header key is not allowed (header key: 'Accept').</p></td> 
  </tr> 
  <tr> 
   <td> WKF-560247 -  Ann HTTP header value is bad (header value: '%s').</td> 
   <td> <p>HTTP header value is bad (header value: '%s'). </p>
    <p>Note: This error is logged when the custom header value fails validation according to <a href="https://tools.ietf.org/html/rfc7230#section-3.2.html">RFC</a></p></td> 
  </tr> 
  <tr> 
   <td> WKF-560240 - JSON payload has bad property '%s'.</td> 
   <td> <p>JSON payload has bad property 'blah'.</p></td>
  </tr> 
  <tr>
   <td> WKF-560241 - Malformed JSON or unacceptable format.</td> 
   <td> <p>Malformed JSON or unacceptable format.</p>
   <p>Note: This message only applies to parsing response body from the external API, and is logged when trying to validate whether the response body conforms to the JSON format mandated by this activity.</p></td>
  </tr>
  <tr> 
   <td> WKF-560246 - Activity failed (reason: '%s').</td> 
   <td> <p>When activity fails due to HTTP 401 error response - Activity failed (reason: 'HTTP - 401')</p>
        <p>When activity fails due to a failed internal call - Activity failed (reason: 'iRc - -Nn').</p>
        <p>When activity fails due to an invalid Content-Type header. - Activity failed (reason: 'Content-Type - application/html').</p></td> 
  </tr>
  <tr> 
   <td> WKF-560278 - "Error initializing OAuth helper (error: '%d')" .</td> 
   <td> <p>This error indicates that the activity could not initialize the internal OAuth2.0 helper facility, due to error in using the attributes configured in the external account to initialize the helper.</p></td>
  </tr>
  <tr> 
   <td> WKF-560279 - "HTTP header key is not allowed (header key: '%s')."</td> 
   <td> <p>This warning (not error) message indicates that the OAuth 2.0 external account has been configured to add a credential as an HTTP header, but the header key used is not allowed because it is a reserved header key.</p></td>
  </tr>
  <tr> 
   <td> WKF-560280 - External account of '%s' ID cannot be found.</td> 
   <td> <p>External account of 'EXT25' ID cannot be found.  Note: This error indicates that the activity is configured to use an external account, which can no longer be found. This is most likely to happen when the account has been deleted from the DB, and as such not likely to happen in normal operating circumstances.</p></td>
  </tr>
  <tr> 
   <td> WKF-560281 - External account of '%s' ID is disabled.</td> 
   <td> <p>External account of 'EXT25' ID is disabled. Note: This error indicates that the activity is configured to use an external account, but that account has been disabled (or marked inactive).</p></td>
  </tr>
  <tr> 
   <td> WKF-560282 - Protocol not supported.</td> 
   <td> <p>This error indicates that the external account associated with the activity is not a OAuth2.0 external account. As such, this error is unlikely to happen unless there is some corruption or manual changes to the activity configuration.</p></td>
  </tr>
  <tr> 
   <td> WKF-560283 - Failed to fetch the OAuth access token.</td> 
   <td> <p>Most common cause of this error is misconfiguration of the external account (for eg. using the external account without testing that the connection is successful). Might be possible that url/credentials on the external account are changed.</p></td>
  </tr>
  <tr> 
   <td> CRL-290199 - Cannot reach page at: %s.</td> 
   <td> <p>This error message is shown on the external Accounts UI screen when setting it up for OAuth. It means that the URL for the external authorization server is either incorrect/changed/response from the server is Page not found.</p></td>
  </tr>
  <tr> 
   <td> CRL-290200 - Incomplete/Incorrect credentials.</td> 
   <td> <p>This error message is shown on the external Accounts UI screen when setting it up for OAuth. This means that credentials are either incorrect or missing some other required credentials to connect to the auth server.
</p></td>
  </tr>
 </tbody> 
</table>

<!--
## Example: Managing coupons with External API Activity

This example illustrates how to **add coupon value** retrieving by a REST call to profiles and then sending an email containing these coupon values.

The workflow is presented as follows:

![](assets/externalAPI_activity_example1.png)

1. Drag and drop an **External API** activity
    1. Parse the JSON sample responsa as {"data":[{"code":"value"}]}.
    1. Add the **Rest endpoint URL** and define authentication setting if needed
    ![](assets/externalAPI_activity_example2.png)
    1. In the **column definition** tab, add a new column called **code** that will store the code value.
        ![](assets/externalAPI_activity_example3.png)
    1. Enabled an **outbound transition** to manage request failures.
1. Drag and drop a **Query** activity
    1. Configure the **Target** tab to query all the **@adobe.com** email. For different Query samples, refer to the [Query](../../automating/using/query.md) section.
    1. In the **additional data** tab, add a new column based on **rowId()** function. This additional column allows you to reconciliate coupon code with the profile ID..
        ![](assets/externalAPI_activity_example4.png)

        >[!NOTE]
        >
        >This reconciliation approach means that the profile query number is equal to the number of coupon values returned by the REST call.
1. Once this two activities are configured, drag and drop an **Enrichment** activity to associate coupon values with profiles.
    1. Select the previous Query activity in the **primarySet** field.
        ![](assets/externalAPI_activity_example5.png)
    1. Create a new relation in the **Advanced relations** tab, and add the following reconciliation criteria:
    1. **@expr1** coming grom the Query activity in the source expression field.
    1. **@lineNum** as an expression that returns the line number for each coupon value in the destination field.
        ![](assets/externalAPI_activity_example6.png)
        More information on the enrichment activity are available [here](../../automating/using/enrichment.md)

    1. The transition **Data Structure** will contain:
        ![](assets/externalAPI_activity_example7.png)
1. Finally drag and drop a **Send via Email** activity.
    You can modify your email template by adding the **code** personnalized field.

-->
