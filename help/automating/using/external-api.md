---
title: External API
description: 
contentOwner: sauviat
products: SG_CAMPAIGN/STANDARD
audience: automating
content-type: reference
topic-tags: targeting-activities
context-tags: externalAPI,workflow,main
internal: n
snippet: y
---

# External API {#external-api}

## Description {#description}

![](assets/wf_externalAPI.png)

The **[!UICONTROL External API]** activity brings data into the workflow from an **external system** via an **HTTP API** call.

The external system endpoints can be public API endpoints, customer management systems, or serverless application instances (e.g., [Adobe I/O Runtime](https://www.adobe.io/apis/experienceplatform/runtime.html)), to mention a few categories.

>[!NOTE]
>
>For security reasons, the use of JSSPs is not supported in Campaign Standard. If you need to execute code, you can call an Adobe I/O Runtime instance via the External API activity.

The main characteristics of this activity are:

* Ability to pass data in a JSON format to a 3rd party REST API endpoint
* Ability to receive a JSON response back, map it to output tables and pass downstream to other workflow activities.
* Failure management with an outbound specific transition

### Transitioning from Beta to GA {#from-beta-to-ga}

With Campaign Standard 20.3 release, External API capability has moved trom Beta to General Availability (GA).

>[!CAUTION]
>
>As a consequence, if you were using beta External API activities, you need to replace them with GA External API activities in all workflows.  Workflows that use the beta version of External API will stop working starting 20.3 release.

When replacing External API activities, add the new External API activity to the workflow, manually copy over the configuration details, then delete the old activity.  

>[!NOTE]
>
>You will not be able to copy over header values as those are masked within the activity.

Next, reconfigure other activities in the workflow which point to and/or use data from the beta External API activity to point to and/or use data from the new External API activity instead. Examples of activities: email delivery (personalization fields), enrichment activity, etc.

### Limitations and guardrails {#guardrails}

The following guardrails have been put in place for this activity:

* 50MB http response data size limit
* Request timeout is 10 minutes
* HTTP redirects are not allowed
* Non-HTTPS Urls are rejected
* "Accept: application/json" request header and "Content-Type: application/json" response header are allowed

>[!CAUTION]
>
>Please note that the activity is meant for fetching campaign-wide data (latest set of offers, latest scores, etc.), not for retrieving specific information for each profile as that can result in large amounts of data being transferred. If the use case requires this, the recommendation is to use the [Transfer File](../../automating/using/transfer-file.md) activity.


Specific guardrails have been put in place for the JSON: 

* **JSON Max Depth**: limit the maximum depth of a custom nested JSON that can be processed to 10 levels.
* **JSON Max Key Length**: limit the maximum length of the internal key generated to 255. This key is associated with the column ID. 
* **JSON Max Duplicate Keys Allowed**:  limit the maximum total number of duplicate JSON property names, which are used as column ID, to 150.


The activity is not supported JSON structure as:

* Combining array object with other non-array elements
* JSON array object is nested within one or more intermediate array objects.


## Configuration {#configuration}

Drag and drop an **[!UICONTROL External API]** activity into your workflow and open the activity to start the configuration.

### Inbound Mapping

Inbound mapping is a temporary table generated by a previous inbound activity that will be displayed and sent as JSON in the UI.
Based on this temporary table, user can make modification to inbound data.

![](assets/externalAPI-inbound.png)

The **Inbound resource** dropdown lets you select the query activity that will create the temporary table.

The **Add count parameter** checkbox will add a count value for each row coming from the temporary table. Note that this checkbox is only available if the inbound activity is generating a temporary table.

The **Inbound Columns** section allow the user to add any fields from the inbound transition table. The selected column(s) will be the keys in the data object. The data object in the JSON will be an array list containing data for selected columns from each row of the inbound transition table.

The **customize parameter** text box lets you add a valid JSON with additional data needed by the external API. This additional data will be added to the params object in the generated JSON.

### Outbound Mapping

This tab lets you define the sample **JSON structure** returned by the API Call.

![](assets/externalAPI-outbound.png)

The JSON parser is designed to accommodate standard JSON structure pattern types, with some exceptions. An example of a standard pattern is:`{“data”:[{“key”:“value”}, {“key”:“value”},...]}`

The sample JSON definition must have the **following characteristics**:

* **Array elements** must contain first-level properties (deeper levels are not supported).
  **Property names** will end up becoming column names for the output schema of the output temporary table.
* **JSON elements** to be captured must be at 10 or less levels of nesting within the JSON response.  
* **Column name** definition is based on the first element of the "data" array.
  Columns definition (add/remove) and the type value of the property can be edited in the **Column definition** tab.

**Flatten checkbox** behavior:

The Flatten checkbox (default: unchecked) is provided to indicate whether to flatten the JSON to a key/value map or not.

* When the **checkbox is disabled** (unchecked), the sample JSON will be parsed to look for an array object. The user will need to provide a trimmed version of the API response sample JSON format so that Adobe Campaign can determine exactly which array the user is interested in using. At workflow authoring time, the path to the nested array object will be determined and recorded, so that it can be used at execution time to access that array object from the JSON response body received from the API call.

* When the **checkbox is enabled** (checked), the sample JSON will be flattened and all the properties that are specified in the provided sample JSON will be used to create columns of the output temporary table, and displayed on the Column Definitions tab. Note that if there are any array object in the sample JSON, then all elements of those array objects will also be flattened.


If the **parsing is validated**, a message appears and invites you to customize the data mapping in the "Column definition" tab. In other cases, an error message is displayed.

### Execution

This tab lets you define the **HTTPS Endpoint** that will send data to ACS. If needed, you can enter authentication information in the fields below.
![](assets/externalAPI-execution.png)

### Properties

This tab lets you control **general properties** on the external API activity like the displayed label in the UI. The internal ID is not customizable.

![](assets/externalAPI-properties.png)

### Column definition

>[!NOTE]
>
>This tab appears when the **response data format** is completed and validated in Outbound Mapping tab.

The **Column definition** tab allows you to precisely specify the data structure of each column in order to import data that does not contain any errors and make it match the types that are already present in the Adobe Campaign database for future operations.

![](assets/externalAPI-column.png)

For example, you can change the label of a column, select its type (string, integer, date, etc.) or even specify error processing.

For more information, refer to the [Load File](../../automating/using/load-file.md) section.

### Transition

This tab lets you activate the **outbound transition** and its label. This specific transition is useful in case of **timeout** or if the payload exceed the **data size limit**.

![](assets/externalAPI-transition.png)

### Execution options

This tab is available in most of the workflow activities. For more information, consult the [Activity properties](../../automating/using/executing-a-workflow.md#activity-properties) section.

![](assets/externalAPI-options.png)

## Troubleshooting

There two types of log messages added to this new workflow activity: information and errors. They can help you troubleshooting potential issues.

### Information

These log messages are used to log information about useful checkpoints during the execution of the workflow activity. Specifically, the following log messages are used to log the first attempt as well a retry attempt (and reason for failure of first attempt) to access the API.

<table> 
 <thead> 
  <tr> 
   <th> Message format<br /> </th> 
   <th> Example<br /> </th> 
  </tr> 
 </thead> 
 <tbody> 
  <tr> 
   <td> Invoking API URL '%s'.</td> 
   <td> <p>Invoking API URL 'https://example.com/api/v1/web-coupon?count=2'.</p></td> 
  </tr> 
  <tr> 
   <td> Retrying API URL '%s', previous attempt failed ('%s').</td> 
   <td> <p>Retrying API URL 'https://example.com/api/v1/web-coupon?count=2', previous attempt failed ('HTTP - 401').</p></td>
  </tr> 
  <tr> 
   <td> Transferring content from '%s' (%s / %s).</td> 
   <td> <p>Transferring content from 'https://example.com/api/v1/web-coupon?count=2' (1234 / 1234).</p></td> 
  </tr>
 </tbody> 
</table>

### Errors

These log messages are used to log information about unexpected error conditions, that can eventually cause the workflow activity to fail.

<table> 
 <thead> 
  <tr> 
   <th> Code - Message format<br /> </th> 
   <th> Example<br /> </th> 
  </tr> 
 </thead> 
 <tbody> 
  <tr> 
   <td> WKF-560250 - API request body exceeded limit (limit: '%d').</td> 
   <td> <p>API request body exceeded limit (limit: '5242880').</p></td> 
  </tr> 
  <tr> 
   <td> WKF-560239 -  API response exceeded limit (limit: '%d').</td> 
   <td> <p>API response exceeded limit (limit: 5242880').</p></td> 
  </tr> 
  <tr> 
   <td> WKF-560245 - API URL could not be parsed (error: '%d').</td> 
   <td> <p>API URL could not be parsed (error: '-2010').</p>
   <p> Note: This error is logged when the API URL fails validation rules.</p></td>
  </tr> 
  <tr>
   <td> WKF-560244 - API URL host must not be 'localhost', or IP address literal (URL host: '%s').</td> 
   <td> <p>API URL host must not be 'localhost', or IP address literal (URL host: 'localhost').</p>
    <p>API URL host must not be 'localhost', or IP address literal (URL host: '192.168.0.5').</p>
    <p>API URL host must not be 'localhost', or IP address literal (URL host: '[2001]').</p></td>
  </tr> 
  <tr> 
   <td> WKF-560238 - API URL must be a secure URL (https) (requested URL: '%s').</td> 
   <td> <p>API URL must be a secure URL (https) (requested URL: 'https://example.com/api/v1/web-coupon?count=2').</p></td> 
  </tr> 
  <tr> 
   <td> WKF-560249 - Failed to create request body JSON. Error when adding '%s'.</td> 
   <td> <p>Failed to create request body JSON. Error when adding 'params'.</p>
    <p>Failed to create request body JSON. Error when adding 'data'.</p></td>
  </tr> 
  <tr> 
   <td> WKF-560246 - HTTP header key is bad (header key: '%s').</td> 
   <td> <p>HTTP header key is bad (header key: '%s').</p>
   <p> Note: This error is logged when the custom header key fails validation according to <a href="https://tools.ietf.org/html/rfc7230#section-3.2.html">RFC</a></p></td> 
  </tr>
 <tr> 
   <td> WKF-560248 - HTTP header key is not allowed (header key: '%s').</td> 
   <td> <p>HTTP header key is not allowed (header key: 'Accept').</p></td> 
  </tr> 
  <tr> 
   <td> WKF-560247 -  AHTTP header value is bad (header value: '%s').</td> 
   <td> <p>HTTP header value is bad (header value: '%s'). </p>
    <p>Note: This error is logged when the custom header value fails validation according to <a href="https://tools.ietf.org/html/rfc7230#section-3.2.html">RFC</a></p></td> 
  </tr> 
  <tr> 
   <td> WKF-560240 - JSON payload has bad property '%s'.</td> 
   <td> <p>JSON payload has bad property 'blah'.</p></td>
  </tr> 
  <tr>
   <td> WKF-560241 - Malformed JSON or unacceptable format.</td> 
   <td> <p>Malformed JSON or unacceptable format.</p>
   <p>Note: This message only applies to parsing response body from the external API, and is logged when trying to validate whether the response body conforms to the JSON format mandated by this activity.</p></td>
  </tr>
  <tr> 
   <td> WKF-560246 - Activity failed (reason: '%s').</td> 
   <td> <p>When activity fails due to HTTP 401 error response - Activity failed (reason: 'HTTP - 401')</p>
        <p>When activity fails due to a failed internal call - Activity failed (reason: 'iRc - -Nn').</p>
        <p>When activity fails due to an invalid Content-Type header. - Activity failed (reason: 'Content-Type - application/html').</p></td> 
  </tr>
 </tbody> 
</table>

<!--
## Example: Managing coupons with External API Activity

This example illustrates how to **add coupon value** retrieving by a REST call to profiles and then sending an email containing these coupon values.

The workflow is presented as follows:

![](assets/externalAPI_activity_example1.png)

1. Drag and drop an **External API** activity
    1. Parse the JSON sample responsa as {"data":[{"code":"value"}]}.
    1. Add the **Rest endpoint URL** and define authentication setting if needed
    ![](assets/externalAPI_activity_example2.png)
    1. In the **column definition** tab, add a new column called **code** that will store the code value.
        ![](assets/externalAPI_activity_example3.png)
    1. Enabled an **outbound transition** to manage request failures.
1. Drag and drop a **Query** activity
    1. Configure the **Target** tab to query all the **@adobe.com** email. For different Query samples, refer to the [Query](../../automating/using/query.md) section.
    1. In the **additional data** tab, add a new column based on **rowId()** function. This additional column allows you to reconciliate coupon code with the profile ID..
        ![](assets/externalAPI_activity_example4.png)

        >[!NOTE]
        >
        >This reconciliation approach means that the profile query number is equal to the number of coupon values returned by the REST call.
1. Once this two activities are configured, drag and drop an **Enrichment** activity to associate coupon values with profiles.
    1. Select the previous Query activity in the **primarySet** field.
        ![](assets/externalAPI_activity_example5.png)
    1. Create a new relation in the **Advanced relations** tab, and add the following reconciliation criteria:
    1. **@expr1** coming grom the Query activity in the source expression field.
    1. **@lineNum** as an expression that returns the line number for each coupon value in the destination field.
        ![](assets/externalAPI_activity_example6.png)
        More information on the enrichment activity are available [here](../../automating/using/enrichment.md)

    1. The transition **Data Structure** will contain:
        ![](assets/externalAPI_activity_example7.png)
1. Finally drag and drop a **Send via Email** activity.
    You can modify your email template by adding the **code** personnalized field.

-->
